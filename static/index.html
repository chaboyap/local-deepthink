<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoA | Network of Agents</title>
    
    <!-- Chart.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" integrity="sha512-CQBWl4fJHWvTMZCRkif3msVOkxyUoI/M8K23TloC2A2xIeU3XtOjE9jB/tH3S6M3mZk5kCC/s4801sVfPvtDQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Prism.js CSS and Toolbar CSS from CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JutnLMiHbLaVBXBSTa9D90a8adnoTttKAjDS/DIHHmRTz3Tgu7JWxfQR7w7yaN2TRax6NSJspstw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" integrity="sha512-DSAA03OP9sEgrizIImQyLIw9vXN4KzUaD2w
    
    <!-- Your local stylesheet MUST be last to override CDN styles if needed -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <h1>It takes a village of agents to raise an insight</h1>

    <div class="container">
        <div id="qnn-import-container" class="section qnn-import-section">
            <h2>Load a Pre-Trained Graph (QNN)</h2>
            <p>Import a previously exported QNN JSON file to run in inference-only mode.</p>
            <form id="import-qnn-form">
                <label for="qnn-file-input">Select QNN File</label>
                <input type="file" id="qnn-file-input" accept=".json">
            </form>
            <div id="imported-qnn-info" class="hidden">
                <p><strong>File Loaded:</strong> <span id="loaded-filename"></span></p>
                <p>A QNN file has been loaded. You can modify the prompt below. Then, click to run inference.</p>
                <div id="inference-options">
                    <button id="inference-only-btn">Run Inference Only</button>
                </div>
            </div>
        </div>

        <div id="graph-architecture-section" class="section">
            <h2>Graph Architecture</h2>
            <form id="graph-params-form">
                <!-- Debug Options -->
                <div class="form-group-horizontal">
                    <div class="checkbox-option">
                        <input type="checkbox" id="debug_mode" name="debug_mode" value="true">
                        <label for="debug_mode">ðŸš€ Enable Debug Mode (Text)</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="coder_debug_mode" name="coder_debug_mode" value="true">
                        <label for="coder_debug_mode">ðŸ’» Enable Coder Debug (Code)</label>
                    </div>
                </div>
                <!-- LLM Model -->
                <div id="ollama-model-section">
                    <label for="ollama_model">Model Name:</label>
                    <input type="text" id="ollama_model" name="ollama_model" disabled>
                </div>
                <!-- Hyperparameters -->
                <label for="cot_trace_depth">CoT Layers (2-16):</label>
                <input type="number" id="cot_trace_depth" name="cot_trace_depth" max="16" min="2" required>
                <label for="num_questions">Questions for Final Report (5-50):</label>
                <input type="number" id="num_questions" name="num_questions" min="5" max="50" required>
                <label for="num_epochs">Number of Epochs:</label>
                <input type="number" id="num_epochs" name="num_epochs" required>
                <!-- Other Hyperparameters -->
                <label for="vector_word_size">Vector Word Size (Verbs per agent):</label>
                <input type="number" id="vector_word_size" name="vector_word_size" min="2" max="10" required>
                <label for="prompt_alignment">Prompt Alignment (0.1-2.0):</label>
                <input type="number" id="prompt_alignment" name="prompt_alignment" step="0.1" min="0.1" max="2.0" required>
                <label for="density">Density (0.1-2.0):</label>
                <input type="number" id="density" name="density" step="0.1" min="0.1" max="2.0" required>
                <!-- MBTI Archetypes -->
                <label>MBTI Archetypes (select at least 2):</label>
                <div class="mbti-grid">
                    <!-- Checkboxes will be populated by JS -->
                </div>
                <!-- Prompt -->
                <label for="prompt">Prompt:</label>
                <textarea id="prompt" name="prompt" required></textarea>
                <button type="button" id="run-button">Build and Run Graph</button>
            </form>
        </div>
    </div>
    
    <div class="container hidden" id="run-interface">
        <div id="diagnostic-chat-container" class="section">
            <h2>Live Diagnostic Chat</h2>
            <div id="diagnostic-chat-messages" class="chat-messages"></div>
            <form id="diagnostic-chat-form" class="chat-form">
                <textarea id="diagnostic-chat-input" placeholder="Waiting for RAG index..." required disabled></textarea>
                <button type="submit" id="diagnostic-chat-send-button" disabled>Query</button>
            </form>
        </div>
        <div class="container" id="perplexity-chart-container">
            <h2>Average Perplexity per Epoch</h2>
            <canvas id="perplexityChart"></canvas>
        </div>
        <div class="container">
            <div class="header-with-button">
                <h2>Real-time Graph Activity</h2>
                <button id="download-log-button" disabled>Download Full Log</button>
            </div>
            <div id="log-container"></div>
        </div>
        <div class="container">
            <h2>Graph Visualization</h2>
            <div id="graph-container">
                <p>ASCII graph will be displayed here after the process starts...</p>
            </div>
        </div>
    </div>

    <div class="container hidden" id="chat-container">
        <div class="header-with-button">
            <h2>Interrogate the Knowledge Base</h2>
            <button id="harvest-button">HARVEST REPORT</button>
        </div>
        <div id="chat-messages" class="chat-messages"></div>
        <form id="chat-form" class="chat-form">
            <textarea id="chat-input" placeholder="Ask follow-up questions for the final report..." required></textarea>
            <button type="submit" id="chat-send-button">Send</button>
        </form>
    </div>

    <div class="container hidden" id="report-container">
        <h2>Final Report Ready</h2>
        <p>The graph execution is complete. The generated papers have been compiled into a zip archive.</p>
        <button id="download-report-button">Download Full Report (.zip)</button>
    </div>

    <div class="container hidden" id="code-result-container">
        <h2>Generated Code</h2>
        <pre><code id="code-output" class="language-python"></code></pre>
        <h3>Reasoning:</h3>
        <p id="code-reasoning"></p>
    </div>

    <div class="container hidden" id="modules-container">
        <h2>Successfully Built Modules</h2>
        <p>The following modules were successfully synthesized and executed during the run.</p>
        <div id="modules-output"></div>
    </div>
    
    <button id="export-qnn-button" class="hidden">Export QNN</button>

    <!-- Prism.js Core & Plugins from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" integrity="sha512-9khQRAUBomGohOKKwyQgZVBqkGcvMdiPOKcvI0S+ixrGO+hgrSAbDXP4iW6LtmP0PlSjG/XOBNGUq8T9AEDJwg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-S_1iUeEC7de5u2aBDPG/hj2Irm7SgbfOP4unWl3sM59P3vT1a44/zCjE/8m4Qk3aNfKjP9WfItWl2i2J0C+ew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js" integrity="sha512-stIn3iCiKk3Cj5w2wG9gS2Y3g7g3axMAlh1sNJVQFvxsjEV9OifIuS9x2r3/I3w0PjIu1Kx3a0B/Sdp2PIxJgA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js" integrity="sha512-L/m+sX7NFEbSVxLS5D1Y60E/tYQ4a/LhpeVrqiZl7weQ/it58t30e7B1goa5sFf00Cj3G3jA/3T/2pS2yCgQrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- This is your application's own code and MUST be served locally -->
    <script src="/static/js/main.js"></script>
</body>